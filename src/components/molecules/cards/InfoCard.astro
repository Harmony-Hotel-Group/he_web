---
// src/components/molecules/cards/InfoCard.astro
import Imagen from "../../atoms/Imagen.astro";

interface Props {
	href: string;
	imageSrc: string;
	imageAlt: string;
	title: string;
	description: string;
	category?: string;
	tags?: string[];
	value?: number;
	valueLabel?: "Valor" | "Desde";
}

const {
	href,
	imageSrc,
	imageAlt,
	title,
	description,
	category,
	tags = [],
	value,
	valueLabel = "Valor",
} = Astro.props;

const truncatedDescription =
	description.length > 200
		? `${description.substring(0, 200)}...`
		: description;

// Currency formatting (minimal, cookie-based)
const selectedCurrency = Astro.cookies.get("currency")?.value || "USD";
const baseCurrency = "USD";
const rates: Record<string, number> = { USD: 1, EUR: 0.92 };
const formatCurrency = (amount: number, currency: string) => {
	try {
		return new Intl.NumberFormat(undefined, {
			style: "currency",
			currency,
		}).format(amount);
	} catch {
		// Fallback: symbol + localized number
		const symbol = currency === "EUR" ? "â‚¬" : "$";
		return `${symbol}${amount.toLocaleString()}`;
	}
};
const convert = (amount: number, from: string, to: string) => {
	const rFrom = rates[from] ?? 1;
	const rTo = rates[to] ?? 1;
	return amount * (rTo / rFrom);
};
const displayValue =
	typeof value === "number"
		? formatCurrency(
				convert(value, baseCurrency, selectedCurrency),
				selectedCurrency,
			)
		: null;
---

<a href={href} class="group bg-white rounded-lg shadow-lg overflow-hidden transform transition-transform duration-300 hover:-translate-y-2 h-full flex flex-col">
  <div class="relative pb-[66.66%]"> {/* 3:2 aspect ratio container */}
    <Imagen
      src={imageSrc} 
      alt={imageAlt} 
      width={600} 
      height={400} 
      class="absolute h-full w-full object-cover" 
    />
  </div>
  <div class="p-6 grow flex flex-col">
    {category && <p class="text-sm text-gray-500 mb-2">{category}</p>}
    <h3 class="text-xl font-bold text-primary mb-2 group-hover:text-accent transition-colors">{title}</h3>
    <p class="text-gray-600 text-sm mb-4 grow">{truncatedDescription}</p>
    
    {displayValue && (
      <div class="mb-4">
        <span class="text-lg font-bold text-accent">{valueLabel}: {displayValue}</span>
      </div>
    )}

    {tags && tags.length > 0 && (
      <div class="flex flex-wrap gap-2 mt-auto">
        {tags.map(tag => (
          <span class="bg-gray-200 text-gray-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">{tag}</span>
        ))}
      </div>
    )}
  </div>
</a>
