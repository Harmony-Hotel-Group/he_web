---
// src/components/organisms/booking/BookingForm.astro
import Grid from "~/layouts/GridLayout.astro"
import DatePickerField from "../../molecules/forms/DatePickerField.astro";
import Button from "../../atoms/Button.astro";

import { Translations } from "~/i18n/translation.ts";

interface Props {
    lang: string;
    config: any;
}

const {lang, config} = Astro.props;

const t = Translations(lang);
console.log("BookingForm.astro Completely loaded");
---

<form id="booking-form" method="post" class="bg-white/20 p-6 rounded-xl shadow-lg space-y-6">
    <Grid cols="3" autoAdjust="true">
        <DatePickerField
                fieldId="dateRange"
                name="dateRange"
                lblKey="booking.dateRangePicker"
                lang={lang}
        />
        <DatePickerField
                fieldId="dateRange"
                name="dateRange"
                lblKey="booking.dateRangePicker"
                lang={lang}
        />
    </Grid>

    <div class="text-center pt-4">
        <Button _id="btnSubmit" type="button" lblKey="booking.search" lang={lang} variant="accent"
                className="w-full md:w-auto px-12"/>
    </div>
</form>

<script>
    import { actions } from 'astro:actions';

    const form: HTMLElement = document.getElementById('booking-form');
    const btn = document.getElementById('btnSubmit');

    btn?.addEventListener('click', async () => {
        const formData = new FormData(form as HTMLFormElement);
        console.log('Formulario enviado:', formData);

        try {
            const {data, error} = await actions.booking(formData);
            console.log('Respuesta del servidor:', data);

            if (error) {
                console.error('Error en booking:', error);
                return;
            }

        } catch (err) {
            console.error('Error inesperado:', err);
        }
    });
</script>