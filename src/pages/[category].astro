---
// src/pages/[category].astro
import BaseLayout from '~/layouts/BaseLayout.astro';
import InfoCard from '~/components/molecules/cards/InfoCard.astro';
import { fetchData } from '~/utils/apiService';
import { Translations } from '~/i18n/translation';

// 1. Define which paths to generate at build time
export async function getStaticPaths() {
  const categories = ['rooms', 'tours', 'destinations', 'gastronomy'];
  return categories.map(category => ({
    params: { category },
  }));
}

const { category } = Astro.params;
const lang = Astro.cookies.get('lang')?.value || 'es';
const t = Translations(lang);

// 2. Map URL category to API endpoint and page title
const categoryInfo = {
  rooms: { titleKey: 'nav.rooms', endpoint: 'rooms' },
  tours: { titleKey: 'nav.tours', endpoint: 'tours' },
  destinations: { titleKey: 'nav.destinations', endpoint: 'destinations' },
  gastronomy: { titleKey: 'nav.gastronomy', endpoint: 'gastronomy' },
};

const info = categoryInfo[category];
let items = [];
let pageTitle = t('site.title'); // Default title

// 3. Fetch data from the corresponding API endpoint
if (info) {
  pageTitle = t(info.titleKey);
  const data = await fetchData(info.endpoint);
  items = data || [];
}
---

<BaseLayout titleKey={info?.titleKey || 'site.title'} lang={lang}>
  <div class="container mx-auto px-6 py-16">
    <h1 class="text-4xl font-bold text-primary text-center mb-12">{pageTitle}</h1>

    {items.length > 0 ? (
      // 4. Render a grid of InfoCards with the fetched data
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {items.map(item => (
          <InfoCard
            href={`/${category}/${item.id}`}
            imageSrc={item.src || item.images?.[0]?.src || '/placeholder.jpg'}
            imageAlt={item.name?.[lang] || 'Image'}
            title={item.name?.[lang] || 'No Title'}
            description={item.description?.[lang] || ''}
            category={item.category?.[lang]}
            tags={item.tags?.[lang]}
            value={item.price}
            valueLabel={item.price ? 'Desde' : undefined}
          />
        ))}
      </div>
    ) : (
      <div class="text-center py-20">
        <p class="text-xl text-gray-500">{t('category.no_items') || 'No hay elementos para mostrar en esta categor√≠a.'}</p>
      </div>
    )}
  </div>
</BaseLayout>
