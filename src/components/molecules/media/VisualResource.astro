---
// src/components/ui/VisualResource.astro
import Imagen from "../../atoms/Imagen.astro"

interface Props {
    src: string;
    type: 'image' | 'video';
    alt?: string;
    classes?: string;
}

let {src, type, alt = '', classes} = Astro.props;

let finalSrc = src;
let isPlaceholder = false;

if (src && src.startsWith('http')) {
    try {
        const response = await fetch(src, {method: 'HEAD'});
        if (!response.ok) {
            console.warn(`[VisualResource] Recurso remoto no encontrado: ${src}`);
            isPlaceholder = true;
        }
    } catch (error) {
        console.error(`[VisualResource] Error al verificar recurso remoto ${src}:`, error);
        isPlaceholder = true;
    }
} else if (!src) {
    isPlaceholder = true;
}

if (isPlaceholder) {
    finalSrc = `https://placehold.co/600x400?text=${type === 'video' ? 'Video' : 'Imagen'}+no+encontrado`;
    type = 'image';
}
---

{type === 'image' ? (
<Imagen
        src={finalSrc}
        alt={alt || (isPlaceholder ? 'Recurso no encontrado' : '')}
        width={600}
        height={400}
        loading="lazy"
        class="w-full h-auto object-cover"
/>
    ) : (
<div class="relative w-full h-full">
    <video
            autoplay
            loop
            muted
            playsinline
            src={finalSrc}
            class:list={['absolute inset-0 w-full h-full object-cover',classes]}
            onError="this.onerror=null;this.src='https://placehold.co/600x400?text=Recurso+no+encontrado';"
    >
        Tu navegador no soporta el elemento de video.
    </video>
</div>
    )}
